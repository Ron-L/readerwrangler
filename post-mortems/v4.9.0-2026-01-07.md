# v4.9.0 Post-Mortem - Ownership Badges & Filter

**Release Date:** 2026-01-07
**Duration:** ~2 sessions (split across context compaction)

## What Was Built

### Ownership Type Badges
- Visual badges on book covers for non-purchased books
- Badge types with distinct colors:
  - Sample (amber) - free samples
  - Borrowed (teal) - shared/family library books
  - Prime/KU/KOLL/Comixology (purple) - subscription-based access
- Positioned in bottom-left corner to avoid conflict with existing badges (read status SE, selection NE)

### Ownership Type Filter
- New dropdown filter in filter panel
- Options: All, Purchased, Sample, Borrowed, Prime, Kindle Unlimited, KOLL, Comixology
- Integrates with Active Filters banner and Clear All functionality
- Persists to localStorage

### Fetcher Enhancement
- Extracts `relationshipSubType` from Amazon API
- Maps to internal ownership types
- Shows ownership summary at end of fetch
- Includes bug report template for unknown types

### Filter Panel Reorganization
- Grouped filters by mental model:
  - Row 1 (Discovery): Search, Read Status, Rating
  - Row 2 (Organization): Collection, Series, Wishlist
  - Row 3 (Acquisition): Ownership
- Rating moved from row 2 to row 1 for logical grouping

## What Went Well

1. **Clean API integration** - Amazon's `relationshipSubType` field provided exactly what we needed
2. **Badge positioning** - Bottom-left avoided all conflicts with existing badges
3. **Filter UX** - Reorganization by mental model made the growing filter panel more intuitive
4. **Design doc first** - BADGES.md spec guided implementation cleanly

## Challenges

1. **Context compaction** - Session split required summarizer to preserve context; worked well
2. **Unknown ownership types** - Built in bug report template for types we haven't seen yet (future-proofing)

## Technical Decisions

1. **Ownership type mapping** - Used descriptive internal values (kindleUnlimited vs KU) for clarity
2. **Badge color scheme** - Amber/teal/purple distinct from existing blue/green UI colors
3. **Filter default** - "All" shows everything; "Purchased" filters to owned books only

## Files Changed

- `amazon-library-fetcher.js` v4.4.0 - ownership extraction
- `readerwrangler.js` v4.9.0 - badges, filter, panel reorg
- `docs/design/BADGES.md` - updated spec
- `docs/design/ORPHAN-DETECTION-RECYCLE-BIN.md` - new design doc (future feature)

## Lessons Learned

1. **Mental model grouping** - When filter panels grow, grouping by user intent (Discovery/Organization/Acquisition) beats alphabetical or chronological ordering
2. **Design docs pay off** - Having BADGES.md spec meant clear implementation path

## Follow-Up Items

- None identified - feature complete as designed
