# v4.1.0 Post-Mortem - Wishlist & Hide Feature

**Release Date:** 2025-12-30
**Duration:** ~3 days (2025-12-28 to 2025-12-30)
**Commits Squashed:** 15 development commits → 1 release commit

## Summary

Major feature release adding Wishlist tracking and Hide functionality. Users can now add books they want to purchase from Amazon product/series pages, and hide books they don't want to see.

## What Went Well

### 1. Phased Design Document
The WISHLIST-FEATURE.md design doc with 6 ordered phases (Fetcher → Loader → App) provided clear implementation path. Each phase built on the previous, reducing integration issues.

### 2. DOM Scraping Fallback
Initial plan was to use Amazon's `kindle-reader-api` for product pages. When that returned 403 Forbidden, pivoted quickly to DOM scraping. Selectors documented in design doc for future reference.

### 3. Series Page Detection
The `.series-childAsin-item` selector reliably detects series pages. Combined with `.hasOwnership` class to skip already-owned books.

### 4. UX Consultation Pattern
Asking "put on your UX expert hat" before implementation decisions led to better outcomes:
- Context menu placement (separator + bottom)
- "Show Hidden" next to result count (not with filters)
- Clear Filters NOT resetting Show Hidden toggle

### 5. Incremental Bug Fixes
Context menu positioning bug (off-screen) and overlay size feedback were caught during testing and fixed in same release cycle.

## What Could Be Improved

### 1. Book Count Bug Discovery
The "2358 of 2352" reversed count issue wasn't caught until late in development. Root cause: dividers were being counted in filtered results but not in total. Better test coverage for edge cases with dividers would help.

### 2. Field Naming Inconsistency
Design doc used `isOwned: false` for wishlist books. App internally uses `isWishlist: true`. Conversion happens in App Loader. Would be cleaner to standardize on one naming convention across all files.

### 3. IIFE Complexity in JSX
The context menu positioning required wrapping in an IIFE to calculate viewport bounds before rendering. This pattern works but adds complexity. Consider extracting to a custom hook or component.

## Technical Decisions

### DOM Scraping vs API
Amazon's product page API (`kindle-reader-api`) returns 403 for non-library pages. DOM scraping is reliable for basic fields (title, author, cover, rating, series) but lacks description/reviews. These can be enriched later via Library Fetcher Pass 3.

### Show Hidden as View Mode, Not Filter
Placing "Show Hidden" next to the result count (not in filter panel) and excluding it from "Clear All Filters" reinforces that it's a view mode toggle, not a subset filter. This matches the mental model of "reveal hidden items" vs "filter to hidden items."

### In-Memory Deduplication
Duplicates (same ASIN as owned + wishlist) are resolved in App Loader memory, not by modifying the JSON file. This keeps fetchers simple (append-only) and prevents file corruption risk.

## Metrics

- **New Files:** 1 (amazon-wishlist-fetcher.js - 744 lines)
- **Modified Files:** 6 (readerwrangler.js +215 lines, bookmarklet-nav-hub.js +59 lines, plus docs)
- **Total Lines Changed:** ~1,086 additions, ~104 deletions
- **Version Iterations:** 6 (v4.1.0.a through v4.1.0.f)

## Lessons Learned

1. **Design-first pays off** - The detailed WISHLIST-FEATURE.md prevented scope creep and provided clear acceptance criteria for each phase.

2. **UX decisions benefit from explicit consultation** - Asking for UX expertise before implementing led to better placement and behavior choices.

3. **Dividers are edge cases** - Any feature touching book counts, filtering, or selection needs to account for dividers in the books array.

4. **Test at viewport boundaries** - Context menu positioning bug only appeared when clicking books at bottom of screen. Need to test UI at all viewport edges.

## Future Considerations

1. **Pass 3 Enrichment** - Wishlist books only have basic fields. Library Fetcher Pass 3 (TODO Priority 5 #3) would enrich them with descriptions/reviews.

2. **Wishlist-to-Owned Transition UX** - When a wishlist book is purchased and re-fetched, it "ungrays" in place. Consider adding a toast notification: "3 wishlist books now owned!"

3. **Bulk Hide** - Current implementation allows hiding multiple selected books. Could add "Hide All in Column" or "Hide All Filtered" for bulk operations.
