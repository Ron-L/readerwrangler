# Post-Mortem: v4.0.1 (2025-12-28)

## Summary
Bug fix release - Ctrl+A now respects active filters when selecting books.

## What Went Well
- **Quick diagnosis**: Root cause identified through code analysis (stale closure in useEffect)
- **Clean fix**: Ref pattern is a standard React solution for this class of problem
- **Bonus fix**: Also excluded dividers from selection (edge case the original code missed)
- **Smooth release process**: Branch → fix → test → merge → tag → push all went cleanly

## What Could Be Improved
- **Original implementation oversight**: The Ctrl+A feature was added without considering that `filteredBooks` could be stale in the event handler closure
- **Testing gap**: No test case for "apply filter then Ctrl+A" during original feature development

## Technical Details
- **Root cause**: `filteredBooks` function captured in useEffect closure was stale when filters changed
- **Solution**: Added `filteredBooksRef` to always hold the current function reference
- **Pattern**: This is a common React pattern for event handlers that need access to current state/props

## Time Spent
- Analysis: ~15 minutes
- Implementation + testing: ~10 minutes
- Release process: ~5 minutes
- **Total**: ~30 minutes (well under the 1-2 hour estimate)

## Files Changed
- `readerwrangler.js` - Added filteredBooksRef, updated Ctrl+A handler
